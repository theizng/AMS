<?xml version="1.0" encoding="utf-8" ?>
<ContentPage
    x:Class="AMS.Views.PaymentFeesPage"
    xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
    xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
    Title="Chi phÃ­">

    <ScrollView>
        <VerticalStackLayout Padding="14" Spacing="18">

            <!-- PHÃ Máº¶C Äá»ŠNH -->
            <Frame Padding="14" BorderColor="#CFD8DC" CornerRadius="12">
                <VerticalStackLayout Spacing="12">
                    <Label Style="{DynamicResource TextPrimary}" Text="PhÃ­ máº·c Ä‘á»‹nh" FontAttributes="Bold" FontSize="20" />
                    <Grid ColumnDefinitions="*,*,Auto" ColumnSpacing="14" RowDefinitions="Auto,Auto" RowSpacing="6">
                        <Label Style="{DynamicResource TextPrimary}" Grid.Row="0" Grid.Column="0" Text="Äiá»‡n (Ä‘/kWh)" FontAttributes="Bold"/>
                        <Label Style="{DynamicResource TextPrimary}" Grid.Row="0" Grid.Column="1" Text="NÆ°á»›c (Ä‘/mÂ³)" FontAttributes="Bold"/>
                        <Entry Style="{DynamicResource TextPrimary}" Grid.Row="1" Grid.Column="0" Keyboard="Numeric" Text="{Binding DefaultElectricRate}" Placeholder="0"/>
                        <Entry Style="{DynamicResource TextPrimary}" Grid.Row="1" Grid.Column="1" Keyboard="Numeric" Text="{Binding DefaultWaterRate}" Placeholder="0"/>
                        <Button Style="{DynamicResource TextPrimary}" Grid.RowSpan="2" Grid.Column="2"
                                Text="LÆ°u"
                                WidthRequest="120"
                                Command="{Binding SaveDefaultFeesCommand}" />
                    </Grid>
                </VerticalStackLayout>
            </Frame>

            <!-- LOáº I PHÃ TÃ™Y CHá»ˆNH -->
            <Frame Padding="14" BorderColor="#CFD8DC" CornerRadius="12">
                <VerticalStackLayout Spacing="12">
                    <Grid ColumnDefinitions="*,Auto,Auto,Auto,Auto,Auto,Auto" ColumnSpacing="10">
                        <Label Style="{DynamicResource TextPrimary}" Grid.Column="0" Text="Loáº¡i phÃ­ tÃ¹y chá»‰nh" FontAttributes="Bold" FontSize="20" />
                        <Button Style="{DynamicResource TextPrimary}" Grid.Column="1" Text="ThÃªm" Command="{Binding AddFeeTypeCommand}" />
                        <Button Style="{DynamicResource TextPrimary}" Grid.Column="2" Text="LÆ°u DS" Command="{Binding SaveFeeTypesCommand}" />
                    </Grid>

                    <!-- Header -->
                    <Grid ColumnDefinitions="*,70,120,100,70,70,50" Padding="0,4" ColumnSpacing="10">
                        <Label Style="{DynamicResource TextPrimary}" Grid.Column="0" Text="TÃªn phÃ­" FontAttributes="Bold"/>
                        <Label Style="{DynamicResource TextPrimary}" Grid.Column="1" Text="Äá»‹nh ká»³" FontAttributes="Bold" HorizontalTextAlignment="Center"/>
                        <Label Style="{DynamicResource TextPrimary}" Grid.Column="2" Text="ÄÆ¡n giÃ¡ máº·c Ä‘á»‹nh" FontAttributes="Bold" HorizontalTextAlignment="Center"/>
                        <Label Style="{DynamicResource TextPrimary}" Grid.Column="3" Text="ÄÆ¡n vá»‹" FontAttributes="Bold" HorizontalTextAlignment="Center"/>
                        <Label Style="{DynamicResource TextPrimary}" Grid.Column="4" Text="KÃ­ch hoáº¡t" FontAttributes="Bold" HorizontalTextAlignment="Center"/>
                        <Label Style="{DynamicResource TextPrimary}" Grid.Column="5" Text="Ãp dá»¥ng táº¥t cáº£ phÃ²ng" FontAttributes="Bold" HorizontalTextAlignment="Center"/>
                        <Label Style="{DynamicResource TextPrimary}" Grid.Column="6" Text="XÃ³a" FontAttributes="Bold" HorizontalTextAlignment="Center"/>
                    </Grid>

                    <CollectionView ItemsSource="{Binding FeeTypes}" SelectionMode="None">
                        <CollectionView.ItemTemplate>
                            <DataTemplate>
                                <Grid ColumnDefinitions="*,70,120,100,70,70,50" ColumnSpacing="10" Padding="0,4">
                                    <Entry Style="{DynamicResource TextPrimary}" Grid.Column="0" Text="{Binding Name}" Placeholder="TÃªn phÃ­"/>
                                    <Switch Grid.Column="1" IsToggled="{Binding IsRecurring}" HorizontalOptions="Center"/>
                                    <Entry Style="{DynamicResource TextPrimary}" Grid.Column="2" Keyboard="Numeric" Text="{Binding DefaultRate}" Placeholder="0"/>
                                    <Entry Style="{DynamicResource TextPrimary}" Grid.Column="3" Text="{Binding UnitLabel}" Placeholder="mÂ³ / thÃ¡ng / láº§n"/>
                                    <Switch Grid.Column="4" IsToggled="{Binding Active}" HorizontalOptions="Center"/>
                                    <Switch Grid.Column="5" IsToggled="{Binding ApplyAllRooms}" HorizontalOptions="Center"/>
                                    <Button Style="{DynamicResource TextPrimary}" Grid.Column="6" Text="ðŸ—‘"
                                            Command="{Binding Source={RelativeSource AncestorType={x:Type ContentPage}}, Path=BindingContext.DeleteFeeTypeCommand}"
                                            CommandParameter="{Binding .}"
                                            BackgroundColor="#EF5350"
                                            TextColor="White"
                                            Padding="4,0"
                                            WidthRequest="44"/>
                                </Grid>
                            </DataTemplate>
                        </CollectionView.ItemTemplate>
                    </CollectionView>
                </VerticalStackLayout>
            </Frame>

            <!-- PHÃ THEO PHÃ’NG -->
            <Frame Padding="14" BorderColor="#CFD8DC" CornerRadius="12">
                <VerticalStackLayout Spacing="12">
                    <Label Style="{DynamicResource TextPrimary}" Text="PhÃ­ theo phÃ²ng (chu ká»³ hiá»‡n táº¡i)" FontAttributes="Bold" FontSize="20" />

                    <CollectionView ItemsSource="{Binding RoomCharges}" SelectionMode="None">
                        <CollectionView.ItemTemplate>
                            <DataTemplate>
                                <Frame Padding="12" BorderColor="#ECEFF1" CornerRadius="10" Margin="0,8">
                                    <VerticalStackLayout Spacing="10">
                                        <Grid ColumnDefinitions="*,Auto" ColumnSpacing="8">
                                            <Label Style="{DynamicResource TextPrimary}" Grid.Column="0" Text="{Binding RoomCode}" FontAttributes="Bold" FontSize="16"/>
                                            <Label Style="{DynamicResource TextPrimary}" Grid.Column="1" Text="{Binding TotalFees, StringFormat='Tá»•ng phÃ­: {0:N0} Ä‘'}"
                                                   FontAttributes="Bold" TextColor="#2E7D32"/>
                                        </Grid>

                                        <Grid ColumnDefinitions="*,70,90,110,50" Padding="0,2" ColumnSpacing="8">
                                            <Label Style="{DynamicResource TextPrimary}" Grid.Column="0" Text="TÃªn" FontAttributes="Bold"/>
                                            <Label Style="{DynamicResource TextPrimary}" Grid.Column="1" Text="SL" FontAttributes="Bold" HorizontalTextAlignment="Center"/>
                                            <Label Style="{DynamicResource TextPrimary}" Grid.Column="2" Text="ÄÆ¡n giÃ¡" FontAttributes="Bold" HorizontalTextAlignment="Center"/>
                                            <Label Style="{DynamicResource TextPrimary}" Grid.Column="3" Text="ThÃ nh tiá»n" FontAttributes="Bold" HorizontalTextAlignment="End"/>
                                            <Label Style="{DynamicResource TextPrimary}" Grid.Column="4" Text="XÃ³a" FontAttributes="Bold" HorizontalTextAlignment="Center"/>
                                        </Grid>

                                        <CollectionView ItemsSource="{Binding Fees}" SelectionMode="None">
                                            <CollectionView.ItemTemplate>
                                                <DataTemplate>
                                                    <Grid ColumnDefinitions="*,70,90,110,50" ColumnSpacing="8" Padding="0,2">
                                                        <Label Style="{DynamicResource TextPrimary}" Grid.Column="0" Text="{Binding Name}" />
                                                        <Entry Style="{DynamicResource TextPrimary}" Grid.Column="1" WidthRequest="70" Text="{Binding Quantity}" Keyboard="Numeric" HorizontalTextAlignment="Center"/>
                                                        <Entry Style="{DynamicResource TextPrimary}" Grid.Column="2" WidthRequest="90" Text="{Binding Rate}" Keyboard="Numeric" HorizontalTextAlignment="Center"/>
                                                        <Label Style="{DynamicResource TextPrimary}" Grid.Column="3" Text="{Binding Amount, StringFormat='{0:N0} Ä‘'}" HorizontalTextAlignment="End"/>
                                                        <Button Style="{DynamicResource TextPrimary}" Grid.Column="4" Text="âœ•"
                                                                Command="{Binding Source={RelativeSource AncestorType={x:Type ContentPage}}, Path=BindingContext.RemoveFeeInstanceCommand}"
                                                                CommandParameter="{Binding .}"
                                                                BackgroundColor="#FF7043"
                                                                TextColor="White"
                                                                Padding="4,0"
                                                                WidthRequest="44"/>
                                                    </Grid>
                                                </DataTemplate>
                                            </CollectionView.ItemTemplate>
                                        </CollectionView>

                                        <Button Style="{DynamicResource TextPrimary}" Text="ThÃªm phÃ­ vÃ o phÃ²ng"
                                                Command="{Binding Source={RelativeSource AncestorType={x:Type ContentPage}}, Path=BindingContext.AddFeeToRoomCommand}"
                                                CommandParameter="{Binding .}"
                                                HorizontalOptions="Start" />
                                    </VerticalStackLayout>
                                </Frame>
                            </DataTemplate>
                        </CollectionView.ItemTemplate>
                    </CollectionView>
                </VerticalStackLayout>
            </Frame>

        </VerticalStackLayout>
    </ScrollView>
</ContentPage>