<?xml version="1.0" encoding="utf-8" ?>
<ContentPage
    xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
    xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
    x:Class="AMS.Views.LoginPage"
    Title="Login">

    <ScrollView>
        <Grid Padding="40">
            <Grid.RowDefinitions>
                <RowDefinition Height="*" />
                <RowDefinition Height="Auto" />
                <RowDefinition Height="*" />
            </Grid.RowDefinitions>

            <VerticalStackLayout Grid.Row="1" Spacing="28">

                <VerticalStackLayout Spacing="6">
                    <Label Text="Quản lý thuê nhà"
                           FontSize="28"
                           FontAttributes="Bold"
                           HorizontalTextAlignment="Center" />
                    <Label Text="Đăng nhập để tiếp tục"
                           FontSize="16"
                           TextColor="#555"
                           HorizontalTextAlignment="Center" />
                </VerticalStackLayout>

                <!-- Username -->
                <Border Stroke="#DDDDDD"
                        StrokeThickness="1"
                        Background="#F3F3F3"
                        Padding="0">
                    <Border.StrokeShape>
                        <RoundRectangle CornerRadius="8" />
                    </Border.StrokeShape>
                    <Grid ColumnDefinitions="Auto,*"
                          ColumnSpacing="12"
                          Padding="12,8"
                          HeightRequest="50">
                        <Image Source="user.png"
                               WidthRequest="24"
                               HeightRequest="24"
                               VerticalOptions="Center" />
                        <Entry Grid.Column="1"
                               x:Name="UsernameEntry"
                               Text="{Binding Username}"
                               Placeholder="Tên đăng nhập"
                               ClearButtonVisibility="WhileEditing"
                               VerticalOptions="Center" />
                    </Grid>
                </Border>

                <!-- Password -->
                <Border Stroke="#DDDDDD"
                        StrokeThickness="1"
                        Background="#F3F3F3"
                        Padding="0">
                    <Border.StrokeShape>
                        <RoundRectangle CornerRadius="8" />
                    </Border.StrokeShape>
                    <Grid ColumnDefinitions="Auto,*"
                          ColumnSpacing="12"
                          Padding="12,8"
                          HeightRequest="50">
                        <Image Source="lock.png"
                               WidthRequest="24"
                               HeightRequest="24"
                               VerticalOptions="Center" />
                        <Entry Grid.Column="1"
                               x:Name="PasswordEntry"
                               Text="{Binding Password}"
                               Placeholder="Mật khẩu"
                               IsPassword="True"
                               VerticalOptions="Center" />
                    </Grid>
                </Border>

                <Button Text="Đăng nhập"
                        Command="{Binding LoginCommand}"
                        HeightRequest="48"
                        CornerRadius="8"
                        BackgroundColor="#555"
                        TextColor="White" />

                <!-- Thêm hiển thị loading khi đang xử lý đăng nhập -->
                <ActivityIndicator IsRunning="{Binding IsBusy}" 
                   IsVisible="{Binding IsBusy}"
                   HorizontalOptions="Center"
                   VerticalOptions="Center"
                   Grid.Row="1"
                   ZIndex="1" />

                <!-- Sửa binding từ LoginMessage thành ErrorMessage để phù hợp với ViewModel -->
                <Label Text="{Binding ErrorMessage}"
                   TextColor="Red"
                   FontSize="14"
                   HorizontalTextAlignment="Center"
                   LineBreakMode="WordWrap" />

            </VerticalStackLayout>
        </Grid>
    </ScrollView>
</ContentPage>