<?xml version="1.0" encoding="utf-8" ?>
<ContentPage
    x:Class="AMS.Views.EditContractPage"
    xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
    xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
    Title="Hợp đồng">

    <ContentPage.ToolbarItems>
        <ToolbarItem Text="Lưu" Order="Primary" Priority="0" Command="{Binding SaveCommand}" />
        <ToolbarItem Text="Kích hoạt" Order="Primary" Priority="1" Command="{Binding ActivateCommand}" />
        <ToolbarItem Text="Chấm dứt" Order="Secondary" Priority="2" Command="{Binding TerminateCommand}" />
    </ContentPage.ToolbarItems>

    <ScrollView>
        <VerticalStackLayout Padding="16" Spacing="16">
            <Label Text="{Binding IsNew, StringFormat='Trạng thái: {0:Contract mới}'}" IsVisible="{Binding IsNew}" />

            <!-- Basic Summary -->
            <Frame Padding="12" CornerRadius="8" BorderColor="#DDD">
                <VerticalStackLayout Spacing="8">
                    <Label Style="{DynamicResource TextPrimary}" Text="Thông tin phòng" FontAttributes="Bold" />
                    <Label Style="{DynamicResource TextPrimary}" Text="{Binding Editable.RoomCode, StringFormat='Phòng: {0}'}" />
                    <Label Style="{DynamicResource TextPrimary}" Text="{Binding Editable.HouseAddress, StringFormat='Nhà: {0}'}" />
                    <Label Style="{DynamicResource TextPrimary}" Text="{Binding Editable.Tenants.Count, StringFormat='Số người thuê: {0}'}" />
                </VerticalStackLayout>
            </Frame>

            <!-- Dates -->
            <Frame Padding="12" CornerRadius="8" BorderColor="#DDD">
                <VerticalStackLayout Spacing="6">
                    <Label Style="{DynamicResource TextPrimary}" Text="Thời hạn hợp đồng" FontAttributes="Bold" />
                    <HorizontalStackLayout Spacing="10">
                        <VerticalStackLayout WidthRequest="150">
                            <Label Style="{DynamicResource TextPrimary}" Text="Ngày bắt đầu" />
                            <DatePicker Style="{DynamicResource TextPrimary}" Date="{Binding StartDate}" />
                        </VerticalStackLayout>
                        <VerticalStackLayout WidthRequest="150">
                            <Label Style="{DynamicResource TextPrimary}" Text="Ngày kết thúc" />
                            <DatePicker Style="{DynamicResource TextPrimary}" Date="{Binding EndDate}" />
                        </VerticalStackLayout>
                        <VerticalStackLayout WidthRequest="100">
                            <Label Style="{DynamicResource TextPrimary}" Text="Ngày thu tiền" />
                            <Entry Style="{DynamicResource TextPrimary}" Keyboard="Numeric" Text="{Binding DueDay}"  Placeholder="Nhập ngày"/>
                        </VerticalStackLayout>
                    </HorizontalStackLayout>
                </VerticalStackLayout>
            </Frame>

            <!-- Rent & Deposit -->
            <Frame Padding="12" CornerRadius="8" BorderColor="#DDD">
                <VerticalStackLayout Spacing="6">
                    <Label Style="{DynamicResource TextPrimary}" Text="Giá phòng và đặt cọc" FontAttributes="Bold" />
                    <HorizontalStackLayout Spacing="10">
                        <VerticalStackLayout WidthRequest="150">
                            <Label Style="{DynamicResource TextPrimary}" Text="Giá phòng / tháng" />
                            <Entry Style="{DynamicResource TextPrimary}" Keyboard="Numeric" Text="{Binding RentAmount}" />
                        </VerticalStackLayout>
                        <VerticalStackLayout WidthRequest="150">
                            <Label Style="{DynamicResource TextPrimary}" Text="Số tiền đặt cọc (tổng)" />
                            <Entry Style="{DynamicResource TextPrimary}" Keyboard="Numeric" Text="{Binding SecurityDeposit}" />
                        </VerticalStackLayout>
                        <VerticalStackLayout WidthRequest="150">
                            <Label Style="{DynamicResource TextPrimary}" Text="Trả cọc sau (ngày)" />
                            <Entry Style="{DynamicResource TextPrimary}" Keyboard="Numeric" Text="{Binding DepositReturnDays}" />
                        </VerticalStackLayout>
                    </HorizontalStackLayout>
                </VerticalStackLayout>
            </Frame>

            <!-- Allowances -->
            <Frame Padding="12" CornerRadius="8" BorderColor="#DDD">
                <VerticalStackLayout Spacing="6">
                    <Label Style="{DynamicResource TextPrimary}" Text="Giới hạn đặt ra" FontAttributes="Bold" />
                    <HorizontalStackLayout Spacing="10">
                        <VerticalStackLayout WidthRequest="140">
                            <Label Style="{DynamicResource TextPrimary}" Text="Số người tối đa" />
                            <Entry Style="{DynamicResource TextPrimary}" Keyboard="Numeric" Text="{Binding MaxOccupants}" />
                        </VerticalStackLayout>
                        <VerticalStackLayout WidthRequest="140">
                            <Label Style="{DynamicResource TextPrimary}" Text="Xe máy tối đa" />
                            <Entry Style="{DynamicResource TextPrimary}" Keyboard="Numeric" Text="{Binding MaxBikeAllowance}" />
                        </VerticalStackLayout>
                    </HorizontalStackLayout>
                </VerticalStackLayout>
            </Frame>

            <!-- Payment policies -->
            <Frame Padding="12" CornerRadius="8" BorderColor="#DDD">
                <VerticalStackLayout Spacing="6">
                    <Label Style="{DynamicResource TextPrimary}" Text="Chính sách thanh toán" FontAttributes="Bold" />
                    <Label Style="{DynamicResource TextPrimary}" Text="Phương thức thanh toán" />
                    <Editor Style="{DynamicResource TextPrimary}" HeightRequest="60" Text="{Binding PaymentMethods}" Placeholder="Ví dụ: Tiền mặt" />
                    <Label Style="{DynamicResource TextPrimary}" Text="Chính sách trễ hạn"/>
                    <Editor Style="{DynamicResource TextPrimary}" HeightRequest="60" Text="{Binding LateFeePolicy}" Placeholder="Ví dụ: Được phép đóng trễ nhất vào ngày 5 hằng tháng"/>
                </VerticalStackLayout>
            </Frame>

            <!-- Property Description -->
            <Frame Padding="12" CornerRadius="8" BorderColor="#DDD">
                <VerticalStackLayout Spacing="6">
                    <Label Style="{DynamicResource TextPrimary}" Text="Mô tả tài sản" FontAttributes="Bold" />
                    <Editor Style="{DynamicResource TextPrimary}" HeightRequest="80" Text="{Binding PropertyDescription}" />
                </VerticalStackLayout>
            </Frame>

            <!-- Tenants snapshot -->
            <Frame Padding="12" CornerRadius="8" BorderColor="#DDD">
                <VerticalStackLayout Spacing="6">
                    <Label Text="Người thuê (snapshot)" FontAttributes="Bold" />
                    <CollectionView ItemsSource="{Binding Editable.Tenants}" SelectionMode="None">
                        <CollectionView.ItemTemplate>
                            <DataTemplate>
                                <HorizontalStackLayout Spacing="8">
                                    <Label Style="{DynamicResource TextPrimary}" Text="{Binding Name}" />
                                    <Label Style="{DynamicResource TextPrimary}" Text="|" TextColor="#999" />
                                    <Label Style="{DynamicResource TextPrimary}" Text="{Binding Phone}" />
                                    <Label Style="{DynamicResource TextPrimary}" Text="|" TextColor="#999" />
                                    <Label Style="{DynamicResource TextPrimary}" Text="{Binding Email}" TextColor="#1976D2" />
                                </HorizontalStackLayout>
                            </DataTemplate>
                        </CollectionView.ItemTemplate>
                    </CollectionView>
                    <Label Style="{DynamicResource TextPrimary}" Text="(Danh sách này được ghi tại thời điểm tạo hợp đồng. Thay đổi sau sẽ đánh dấu 'Cần phụ lục'.)"
                           FontSize="12" TextColor="#666"/>
                </VerticalStackLayout>
            </Frame>

            <!-- PDF link -->
            <Frame Padding="12" CornerRadius="8" BorderColor="#DDD">
                <VerticalStackLayout Spacing="6">
                    <Label Style="{DynamicResource TextPrimary}" Text="Tài liệu hợp đồng (PDF)" FontAttributes="Bold" />
                    <Entry Style="{DynamicResource TextPrimary}" Placeholder="Link PDF (nếu đã tạo)" Text="{Binding PdfUrl}" />
                </VerticalStackLayout>
            </Frame>

            <!-- Action buttons (duplicate of toolbar for convenience) -->
            <HorizontalStackLayout Spacing="12" HorizontalOptions="Center">
                <Button Text="Lưu" Command="{Binding SaveCommand}" />
                <Button Text="Kích hoạt" Command="{Binding ActivateCommand}" />
                <Button Text="Chấm dứt" BackgroundColor="#FFCDD2" Command="{Binding TerminateCommand}" />
            </HorizontalStackLayout>
        </VerticalStackLayout>
    </ScrollView>
</ContentPage>